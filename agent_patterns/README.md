# Agent 模式示例

本目录包含多个示例文件，展示了不同的Agent使用模式和最佳实践。这些模式可以帮助你构建更强大、更可靠的AI应用。

## 核心模式

### 1. 确定性流程 (Deterministic Flows)
- **文件**: `deterministic.py`
- **功能**: 将复杂任务分解为一系列小步骤
- **特点**:
  - 每个步骤由专门的Agent处理
  - 前一个Agent的输出作为下一个Agent的输入
  - 确保流程的可控性和可预测性
- **应用场景**: 故事生成、多步骤任务处理等

### 2. 代理切换与路由 (Handoffs and Routing)
- **文件**: `routing.py`
- **功能**: 实现多语言路由系统
- **特点**:
  - 支持法语、西班牙语和英语三种语言
  - 使用语言检测代理自动判断用户输入
  - 根据语言自动切换到对应的代理
  - 支持对话上下文的保持和切换
- **应用场景**: 多语言客服系统、国际化应用等

### 3. 代理作为工具 (Agents as Tools)
- **文件**: `agents_as_tools.py`
- **功能**: 将Agent作为可调用的工具使用
- **特点**:
  - 一个Agent可以调用其他Agent
  - 支持Agent之间的协作
  - 实现复杂的任务分解
  - 支持并行处理多个任务
- **应用场景**: 多语言翻译、并行任务处理等

### 4. LLM作为评判者 (LLM-as-a-judge)
- **文件**: `llm_as_a_judge.py`
- **功能**: 使用LLM评估和改进输出质量
- **特点**:
  - 评估其他代理的输出质量
  - 提供评分和反馈
  - 支持多维度评估
  - 可以优化成本（小模型生成，大模型评估）
- **应用场景**: 内容质量评估、输出优化等

### 5. 并行处理 (Parallelization)
- **文件**: `parallelization.py`
- **功能**: 并行执行多个Agent任务
- **特点**:
  - 同时执行多个翻译任务
  - 使用评选代理选择最佳结果
  - 利用`asyncio.gather`实现并行处理
  - 支持结果比较和选择
- **应用场景**: 多版本生成、最佳结果选择等

### 6. 护栏机制 (Guardrails)
- **输入护栏**: `input_guardrails.py`
  - 验证用户输入的有效性
  - 拦截不合适的输入
  - 提供输入验证规则
  - 快速拒绝无效输入，提高性能

- **输出护栏**: `output_guardrails.py`
  - 检测输出中是否包含敏感信息
  - 使用正则表达式进行模式匹配
  - 可以拦截不符合要求的输出
  - 提供详细的错误信息

### 7. 强制工具使用 (Forcing Tool Use)
- **文件**: `forcing_tool_use.py`
- **功能**: 强制Agent使用特定工具
- **特点**:
  - 通过`ModelSettings`配置强制工具使用
  - 支持多种工具使用行为
  - 可以自定义工具处理逻辑
- **应用场景**: 确保特定功能被调用、强制使用特定API等

## 环境配置

所有示例都需要以下环境变量：
- `API_BASE`：API基础URL（默认：https://api.deepseek.com）
- `API_KEY`：API密钥
- `MODEL_NAME`：模型名称（默认：deepseek-chat）

## 运行方式

1. 确保已设置必要的环境变量
2. 选择需要的示例文件运行：
   ```bash
   python routing.py
   # 或
   python parallelization.py
   # 或其他示例文件
   ```

## 最佳实践

1. **性能优化**：
   - 所有示例都禁用了tracing功能以提高性能
   - Windows环境下会自动设置适当的事件循环策略

2. **错误处理**：
   - 建议实现适当的错误处理机制
   - 使用护栏机制拦截无效输入和输出

3. **资源管理**：
   - 合理使用并行处理提高效率
   - 根据任务复杂度选择合适的模型

4. **安全考虑**：
   - 使用输入输出护栏确保安全性
   - 验证所有用户输入和模型输出
